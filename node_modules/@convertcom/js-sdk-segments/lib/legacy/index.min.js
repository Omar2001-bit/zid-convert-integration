/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";var e,t;!function(e){e.VARIAION_NOT_DECIDED="convert.com_variation_not_decided"}(e||(e={})),function(e){e.FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions"}(t||(t={}));const n="Segments not found",r="Custom segments key already set";var o,a,i,s,u,c,d,l,g,E,S,f,C,N,T;!function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(o||(o={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(a||(a={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(i||(i={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(s||(s={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(u||(u={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(c||(c={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(d||(d={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(l||(l={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(g||(g={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(E||(E={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(S||(S={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(f||(f={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(C||(C={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(N||(N={})),function(e){e.NEW="new",e.RETURNING="returning"}(T||(T={}));var R,A,O;function p(e){if("number"==typeof e)return!0;const t=parseFloat(String(e));return Number.isFinite(t)&&!isNaN(t)}function h(e){if("number"==typeof e)return e;const t=String(e).split(",");return parseFloat("0"==t[0]?String(e).replace(/,/g,"."):String(e).replace(/,/g,""))}R={exports:{}},function(){const e=e=>(new TextEncoder).encode(e);function t(t,n){let r,o,a,i,s,u,c,d;for("string"==typeof t&&(t=e(t)),r=3&t.length,o=t.length-r,a=n,s=3432918353,u=461845907,d=0;d<o;)c=255&t[d]|(255&t[++d])<<8|(255&t[++d])<<16|(255&t[++d])<<24,++d,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*u+(((c>>>16)*u&65535)<<16)&4294967295,a^=c,a=a<<13|a>>>19,i=5*(65535&a)+((5*(a>>>16)&65535)<<16)&4294967295,a=27492+(65535&i)+((58964+(i>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&t[d+2])<<16;case 2:c^=(255&t[d+1])<<8;case 1:c^=255&t[d],c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*u+(((c>>>16)*u&65535)<<16)&4294967295,a^=c}return a^=t.length,a^=a>>>16,a=2246822507*(65535&a)+((2246822507*(a>>>16)&65535)<<16)&4294967295,a^=a>>>13,a=3266489909*(65535&a)+((3266489909*(a>>>16)&65535)<<16)&4294967295,a^=a>>>16,a>>>0}const n=t;n.v2=function(t,n){"string"==typeof t&&(t=e(t));let r,o=t.length,a=n^o,i=0;for(;o>=4;)r=255&t[i]|(255&t[++i])<<8|(255&t[++i])<<16|(255&t[++i])<<24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),r^=r>>>24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^r,o-=4,++i;switch(o){case 3:a^=(255&t[i+2])<<16;case 2:a^=(255&t[i+1])<<8;case 1:a^=255&t[i],a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)}return a^=a>>>13,a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16),a^=a>>>15,a>>>0},n.v3=t,R.exports=n}();class m{static equals(e,t,n){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),n):"object"==typeof(r=e)&&null!==r&&Object.keys(r).length>0?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),n):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,n));var r}static less(e,t,n){return typeof(e=p(e)?h(e):e)==typeof(t=p(t)?h(t):t)&&this._returnNegationCheck(e<t,n)}static lessEqual(e,t,n){return typeof(e=p(e)?h(e):e)==typeof(t=p(t)?h(t):t)&&this._returnNegationCheck(e<=t,n)}static contains(e,t,n){return e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length?this._returnNegationCheck(!0,n):this._returnNegationCheck(-1!==e.indexOf(t),n)}static isIn(e,t,n=!1,r="|"){const o=String(e).split(r).map((e=>String(e)));"string"==typeof t&&(t=t.split(r)),Array.isArray(t)||(t=[]),t=t.map((e=>String(e).valueOf().toLowerCase()));for(let e=0;e<o.length;e++)if(-1!==t.indexOf(o[e]))return this._returnNegationCheck(!0,n);return this._returnNegationCheck(!1,n)}static startsWith(e,t,n){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),n)}static endsWith(e,t,n){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),n)}static regexMatches(e,t,n){e=String(e).valueOf().toLowerCase(),t=String(t).valueOf();const r=new RegExp(t,"i");return this._returnNegationCheck(r.test(e),n)}static _returnNegationCheck(e,t=!1){return t?!e:e}}A=m,m.equalsNumber=A.equals,m.matches=A.equals,"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(O||(O={}));exports.SegmentsManager=class{constructor(e,{dataManager:t,ruleManager:n,loggerManager:r}){this._dataManager=t,this._ruleManager=n,this._loggerManager=r,this._data=function(e,t,n,r=!1){try{if("object"==typeof e){const n=t.split(".").reduce(((e,t)=>e[t]),e);if(n||r&&(!1===n||0===n))return n}}catch(e){}return null}(e,"data")}getSegments(e){const t=this._dataManager.getData(e)||{},{segments:n}=this._dataManager.filterReportSegments(null==t?void 0:t.segments);return n}putSegments(e,t){const{segments:n}=this._dataManager.filterReportSegments(t);n&&this._dataManager.putData(e,{segments:n})}setCustomSegments(e,t,o){var a,i,s,u,c;const d=this._dataManager.getData(e)||{},{segments:{[C.CUSTOM_SEGMENTS]:g=[]}={}}=d,E=[];let S,f=!1;for(const e of t){if(o&&!f&&(f=this._ruleManager.isRuleMatched(o,null==e?void 0:e.rules,`ConfigSegment #${null==e?void 0:e.id}`),Object.values(l).includes(f)))return f;if(!o||f){const t=null===(a=null==e?void 0:e.id)||void 0===a?void 0:a.toString();g.includes(t)?null===(s=null===(i=this._loggerManager)||void 0===i?void 0:i.warn)||void 0===s||s.call(i,"SegmentsManager.setCustomSegments()",r):E.push(t)}}return E.length?(S=Object.assign(Object.assign({},d.segments||{}),{[C.CUSTOM_SEGMENTS]:[...g,...E]}),this.putSegments(e,S)):null===(c=null===(u=this._loggerManager)||void 0===u?void 0:u.warn)||void 0===c||c.call(u,"SegmentsManager.setCustomSegments()",n),S}selectCustomSegments(e,t,n){const r=this._dataManager.getEntities(t,"segments");return this.setCustomSegments(e,r,n)}selectCustomSegmentsByIds(e,t,n){const r=this._dataManager.getEntitiesByIds(t,"segments");return this.setCustomSegments(e,r,n)}};
//# sourceMappingURL=index.min.js.map
