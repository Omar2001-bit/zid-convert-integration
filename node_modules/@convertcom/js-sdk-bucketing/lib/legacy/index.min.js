/*!
 * Convert JS SDK
 * Version 1.0.0
 * Copyright(c) 2020-2022 Convert Insights, Inc
 * License Apache-2.0
 */
"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t,n={exports:{}};t=n,function(){const e=e=>(new TextEncoder).encode(e);function n(t,n){let r,o,i,a,s,u,c,l;for("string"==typeof t&&(t=e(t)),r=3&t.length,o=t.length-r,i=n,s=3432918353,u=461845907,l=0;l<o;)c=255&t[l]|(255&t[++l])<<8|(255&t[++l])<<16|(255&t[++l])<<24,++l,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*u+(((c>>>16)*u&65535)<<16)&4294967295,i^=c,i=i<<13|i>>>19,a=5*(65535&i)+((5*(i>>>16)&65535)<<16)&4294967295,i=27492+(65535&a)+((58964+(a>>>16)&65535)<<16);switch(c=0,r){case 3:c^=(255&t[l+2])<<16;case 2:c^=(255&t[l+1])<<8;case 1:c^=255&t[l],c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*u+(((c>>>16)*u&65535)<<16)&4294967295,i^=c}return i^=t.length,i^=i>>>16,i=2246822507*(65535&i)+((2246822507*(i>>>16)&65535)<<16)&4294967295,i^=i>>>13,i=3266489909*(65535&i)+((3266489909*(i>>>16)&65535)<<16)&4294967295,i^=i>>>16,i>>>0}const r=n;r.v2=function(t,n){"string"==typeof t&&(t=e(t));let r,o=t.length,i=n^o,a=0;for(;o>=4;)r=255&t[a]|(255&t[++a])<<8|(255&t[++a])<<16|(255&t[++a])<<24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),r^=r>>>24,r=1540483477*(65535&r)+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^r,o-=4,++a;switch(o){case 3:i^=(255&t[a+2])<<16;case 2:i^=(255&t[a+1])<<8;case 1:i^=255&t[a],i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)}return i^=i>>>13,i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16),i^=i>>>15,i>>>0},r.v3=n,t.exports=r}();var r,o,i,a=e(n.exports);function s(e){if("number"==typeof e)return!0;const t=parseFloat(String(e));return Number.isFinite(t)&&!isNaN(t)}function u(e){if("number"==typeof e)return e;const t=String(e).split(",");return parseFloat("0"==t[0]?String(e).replace(/,/g,"."):String(e).replace(/,/g,""))}class c{static equals(e,t,n){return Array.isArray(e)?this._returnNegationCheck(-1!==e.indexOf(t),n):"object"==typeof(r=e)&&null!==r&&Object.keys(r).length>0?this._returnNegationCheck(-1!==Object.keys(e).indexOf(String(t)),n):(e=String(e),t=String(t),e=e.valueOf().toLowerCase(),t=t.valueOf().toLowerCase(),this._returnNegationCheck(e===t,n));var r}static less(e,t,n){return typeof(e=s(e)?u(e):e)==typeof(t=s(t)?u(t):t)&&this._returnNegationCheck(e<t,n)}static lessEqual(e,t,n){return typeof(e=s(e)?u(e):e)==typeof(t=s(t)?u(t):t)&&this._returnNegationCheck(e<=t,n)}static contains(e,t,n){return e=String(e),t=String(t),e=e.valueOf().toLowerCase(),0===(t=t.valueOf().toLowerCase()).replace(/^([\s]*)|([\s]*)$/g,"").length?this._returnNegationCheck(!0,n):this._returnNegationCheck(-1!==e.indexOf(t),n)}static isIn(e,t,n=!1,r="|"){const o=String(e).split(r).map((e=>String(e)));"string"==typeof t&&(t=t.split(r)),Array.isArray(t)||(t=[]),t=t.map((e=>String(e).valueOf().toLowerCase()));for(let e=0;e<o.length;e++)if(-1!==t.indexOf(o[e]))return this._returnNegationCheck(!0,n);return this._returnNegationCheck(!1,n)}static startsWith(e,t,n){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(0===e.indexOf(t),n)}static endsWith(e,t,n){return e=String(e).valueOf().toLowerCase(),t=String(t).valueOf().toLowerCase(),this._returnNegationCheck(-1!==e.indexOf(t,e.length-t.length),n)}static regexMatches(e,t,n){e=String(e).valueOf().toLowerCase(),t=String(t).valueOf();const r=new RegExp(t,"i");return this._returnNegationCheck(r.test(e),n)}static _returnNegationCheck(e,t=!1){return t?!e:e}}r=c,c.equalsNumber=r.equals,c.matches=r.equals,"function"==typeof SuppressedError&&SuppressedError,function(e){e.VARIAION_NOT_DECIDED="convert.com_variation_not_decided"}(o||(o={})),function(e){e.FORCE_MULTIPLE_TRANSACTIONS="forceMultipleTransactions"}(i||(i={}));const l="Bucketing Manager constructor has been called";var d,g,E,f,A,N,O,R,T,h,p,C,S,_,v,I;!function(e){e.OFF="OFF",e.EU_ONLY="EU ONLY",e.EEA_ONLY="EEA ONLY",e.WORLDWIDE="Worldwide"}(d||(d={})),function(e){e.AUDIENCE="audience",e.LOCATION="location",e.SEGMENT="segment",e.FEATURE="feature",e.GOAL="goal",e.EXPERIENCE="experience",e.VARIATION="variation"}(g||(g={})),function(e){e.ENABLED="enabled",e.DISABLED="disabled"}(E||(E={})),function(e){e.AMOUNT="amount",e.PRODUCTS_COUNT="productsCount",e.TRANSACTION_ID="transactionId"}(f||(f={})),function(e){e[e.TRACE=0]="TRACE",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(A||(A={})),function(e){e.LOG="log",e.TRACE="trace",e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(N||(N={})),function(e){e.WEB="web",e.FULLSTACK="fullstack"}(O||(O={})),function(e){e.NO_DATA_FOUND="convert.com_no_data_found",e.NEED_MORE_DATA="convert.com_need_more_data"}(R||(R={})),function(e){e.READY="ready",e.CONFIG_UPDATED="config.updated",e.API_QUEUE_RELEASED="api.queue.released",e.BUCKETING="bucketing",e.CONVERSION="conversion",e.SEGMENTS="segments",e.LOCATION_ACTIVATED="location.activated",e.LOCATION_DEACTIVATED="location.deactivated",e.AUDIENCES="audiences",e.DATA_STORE_QUEUE_RELEASED="datastore.queue.released"}(T||(T={})),function(e){e.RICH_STRUCTURE="richStructure",e.CUSTOM_CODE="customCode",e.DEFAULT_CODE="defaultCode",e.DEFAULT_CODE_MULTIPAGE="defaultCodeMultipage",e.DEFAULT_REDIRECT="defaultRedirect",e.FULLSTACK_FEATURE="fullStackFeature"}(h||(h={})),function(e){e.IE="IE",e.CH="CH",e.FF="FF",e.OP="OP",e.SF="SF",e.EDG="EDG",e.MO="MO",e.NS="NS",e.OTH="OTH"}(p||(p={})),function(e){e.ALLPH="ALLPH",e.IPH="IPH",e.OTHPH="OTHPH",e.ALLTAB="ALLTAB",e.IPAD="IPAD",e.OTHTAB="OTHTAB",e.DESK="DESK",e.OTHDEV="OTHDEV"}(C||(C={})),function(e){e.COUNTRY="country",e.BROWSER="browser",e.DEVICES="devices",e.SOURCE="source",e.CAMPAIGN="campaign",e.VISITOR_TYPE="visitorType",e.CUSTOM_SEGMENTS="customSegments"}(S||(S={})),function(e){e.CAMPAIGN="campaign",e.SEARCH="search",e.REFERRAL="referral",e.DIRECT="direct"}(_||(_={})),function(e){e.NEW="new",e.RETURNING="returning"}(v||(v={})),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(I||(I={}));exports.BucketingManager=class{constructor(e,{loggerManager:t}={}){var n,r,o,i;this._max_traffic=1e4,this._hash_seed=9999,this._loggerManager=t,this._max_traffic=(null===(n=null==e?void 0:e.bucketing)||void 0===n?void 0:n.max_traffic)||1e4,this._hash_seed=(null===(r=null==e?void 0:e.bucketing)||void 0===r?void 0:r.hash_seed)||9999,null===(i=null===(o=this._loggerManager)||void 0===o?void 0:o.trace)||void 0===i||i.call(o,"BucketingManager()",l,this)}selectBucket(e,t,n=0){var r,o;let i=null,a=0;return Object.keys(e).some((r=>(a+=100*e[r]+n,t<a&&(i=r,!0)))),null===(o=null===(r=this._loggerManager)||void 0===r?void 0:r.debug)||void 0===o||o.call(r,"BucketingManager.selectBucket()",{buckets:e,value:t,redistribute:n},{variation:i}),i||null}getValueVisitorBased(e,t){var n,r;const{seed:o=this._hash_seed,experienceId:i=""}=t||{},s=function(e,t=9999){return a.v3(String(e),t)}(i+String(e),o),u=s/4294967296*this._max_traffic,c=parseInt(String(u),10);return null===(r=null===(n=this._loggerManager)||void 0===n?void 0:n.debug)||void 0===r||r.call(n,"BucketingManager.getValueVisitorBased()",{visitorId:e,seed:o,experienceId:i,val:u,result:c}),c}getBucketForVisitor(e,t,n){const r=this.getValueVisitorBased(t,n),o=this.selectBucket(e,r,null==n?void 0:n.redistribute);return o?{variationId:o,bucketingAllocation:r}:null}};
//# sourceMappingURL=index.min.js.map
